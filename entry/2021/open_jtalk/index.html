
<!DOCTYPE html>
<html lang="ja-JP">
<head>
  

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Open JTalk in Docker - えやみぐさ</title>
  


<link rel="shortcut icon" href="../../../favicon.ico">




<meta property="og:url" content="https://blog.aoirint.com/entry/2021/open_jtalk/" />
<meta property="og:locale" content="ja-JP" />
<meta property="og:type" content="article" />

<meta property="og:title" content="Open JTalk in Docker - えやみぐさ" />

<meta name="description" content="Open JTalk in Docker 以前にもOpen JTalkを触っていたが、時間が経った＆記事が雑だったのでDockerでまとめ直しておく。 Open JTalk - aoirint&#39;s note Dockerfileを作る。 FROM ubuntu:bionic RUN a"/>
<meta property="og:description" content="Open JTalk in Docker 以前にもOpen JTalkを触っていたが、時間が経った＆記事が雑だったのでDockerでまとめ直しておく。 Open JTalk - aoirint&#39;s note Dockerfileを作る。 FROM ubuntu:bionic RUN a" />
<meta property="og:image" content="https://blog.aoirint.com/ogp.png" />
<meta property="article:published_time" content="2021-04-04T08:00:00+09:00" />

<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@aoirint">
<meta name="twitter:creator" content="@aoirint">


<link href="https://blog.aoirint.com/atom.xml" type="application/atom+xml" rel="alternate" title="えやみぐさ Atom Feed" />
<link href="https://blog.aoirint.com/rss.rdf" type="application/rss+xml" rel="alternate" title="えやみぐさ RSS Feed" />

<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../../../static/aoirint-blog/css/style.css">

<script defer src="../../../static/fontawesome/js/all.min.js"></script>
  <script defer src="../../../static/fontawesome/js/v4-shims.min.js"></script>
<link rel="stylesheet" href="../../../static/pygments/native.css">


    
  

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-157155944-5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-157155944-5');
  </script>
  

<script src="../../../static/aoirint-blog/js/main.js"></script>

<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>


</head>

<body>
  

<nav class="sitebar">
  <div class="sitebar-left">
    
    <a href="https://cse.google.com/cse?cx=4b57e8a4ef2a8c489" target="_blank" class="sitebar-button">
      <i class="fas fa-search"></i>
    </a>
    

    <a href="../../../atom.xml" title="RSS Feed" class="sitebar-button">
      <i class="fas fa-rss"></i>
    </a>

  <!--
    <a href="../../../atom.xml" title="Atom Feed" class="sitebar-button">
      <i class="fas fa-rss"></i>
    </a>
  -->

    
    <a href="https://twitter.com/aoirint" target="_blank" title="Twitter @aoirint" class="sitebar-button">
      <i class="fab fa-twitter"></i>
    </a>
    

    
    <a href="https://github.com/aoirint" target="_blank" title="GitHub @aoirint" class="sitebar-button">
      <i class="fab fa-github"></i>
    </a>
    
  </div>


  <div class="sitebar-center">
    <a href="../../../" class="sitebar-title">
      えやみぐさ
    </a>
    
    <div class="sitebar-description">
      Blog by aoirint
    </div>
    
  </div>

  <div class="sitebar-right">
    <button class="toggle-tocbar sitebar-button" type="button" onclick="toggleTocBarIfSmartphone();">
      <i class="fas fa-list"></i>
    </button>

  </div>

</nav>

<main class="main-content">

<div class="container">


<article class="article">


<div class="article-metadata">
  <div class="article-date">
    2021-04-04
  </div>

  <div class="article-tags">

    <a href="../../../category/音声合成/" class="article-category">
      音声合成
    </a>



    <a href="../../../tags/音声合成/" class="article-tag">
      音声合成
    </a>

    <a href="../../../tags/Open JTalk/" class="article-tag">
      Open JTalk
    </a>

    <a href="../../../tags/Docker/" class="article-tag">
      Docker
    </a>

  </div>

</div>



<div class="article-body">
  <h1 class="md_header_block" id="h_entry_2021_open_jtalk_index_md_Open_JTalk_in_Docker">Open JTalk in Docker</h1>
<p>以前にもOpen JTalkを触っていたが、時間が経った＆記事が雑だったのでDockerでまとめ直しておく。</p>
<ul>
<li><a href="https://aoirint.hatenablog.com/entry/2019/05/25/080329">Open JTalk - aoirint's note</a></li>
</ul>
<p>Dockerfileを作る。</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span> <span class="s">ubuntu:bionic</span>

<span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> <span class="se">\</span>
    apt-get install -y <span class="se">\</span>
        open-jtalk <span class="se">\</span>
        open-jtalk-mecab-naist-jdic <span class="se">\</span>
        hts-voice-nitech-jp-atr503-m001

<span class="k">WORKDIR</span><span class="s"> /data</span>
<span class="k">ENTRYPOINT</span> <span class="p">[</span> <span class="s2">"open_jtalk"</span> <span class="p">]</span>
</code></pre></div>
<p>mecab-naist-jdicは形態素解析辞書。
hts-voiceはボイスファイルだが、別途htsvoiceを用意する場合は不要。</p>
<p>ビルドする。</p>
<div class="highlight"><pre><span></span><code>docker build . -t aoirint/open_jtalk
</code></pre></div>
<p>実行する。</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span> <span class="s2">"こんにちは"</span> &gt; text.txt

<span class="c1"># テキストファイルの文字列から音声を生成</span>
docker run --rm -v <span class="s2">"</span><span class="nv">$PWD</span><span class="s2">:/data"</span> aoirint/open_jtalk -x /var/lib/mecab/dic/open-jtalk/naist-jdic/ -m /usr/share/hts-voice/nitech-jp-atr503-m001/nitech_jp_atr503_m001.htsvoice text.txt -ow output.wav

<span class="c1"># 標準入力の文字列から音声を生成</span>
cat text.txt <span class="p">|</span> docker run --rm -i -v <span class="s2">"</span><span class="nv">$PWD</span><span class="s2">:/data"</span> aoirint/open_jtalk -x /var/lib/mecab/dic/open-jtalk/naist-jdic/ -m /usr/share/hts-voice/nitech-jp-atr503-m001/nitech_jp_atr503_m001.htsvoice -ow output.wav

<span class="c1"># 標準入力の文字列から音声を生成して、標準出力に書き出す（wav形式）</span>
cat text.txt <span class="p">|</span> docker run --rm -i -v <span class="s2">"</span><span class="nv">$PWD</span><span class="s2">:/data"</span> aoirint/open_jtalk -x /var/lib/mecab/dic/open-jtalk/naist-jdic/ -m /usr/share/hts-voice/nitech-jp-atr503-m001/nitech_jp_atr503_m001.htsvoice -ow /dev/stdout &gt; output.wav
</code></pre></div>
<p>ffmpegで出力されたwavファイルを見るとこのような形式。</p>
<div class="highlight"><pre><span></span><code>Input #0, wav, from 'output.wav':
  Duration: 00:00:01.61, bitrate: 768 kb/s
    Stream #0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 48000 Hz, mono, s16, 768 kb/s
</code></pre></div>
<p>続いて、mmdagent.jpで配布されているボイスファイル（htsvoice）を使ってみる。</p>
<ul>
<li><a href="https://sourceforge.net/projects/mmdagent/files/MMDAgent_Example/">MMDAgent - Browse /MMDAgent_Example at SourceForge.net</a></li>
</ul>
<p>ここから最新のMMDAgent Exampleをダウンロードする。
<code>Voice/mei/mei_normal.htsvoice</code>に目的のボイスファイルがある（CC BY 3.0）。
これを作業ディレクトリ（<code>$PWD</code>）にコピーしておく。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 他のhtsvoiceを使う（mei_normal.htsvoice）</span>
docker run --rm -v <span class="s2">"</span><span class="nv">$PWD</span><span class="s2">:/data"</span> aoirint/open_jtalk -x /var/lib/mecab/dic/open-jtalk/naist-jdic/ -m /data/mei_normal.htsvoice text.txt -ow output.wav
</code></pre></div>
<p>ヘルプはこのようになっている。</p>
<div class="highlight"><pre><span></span><code>$ docker run --rm -it -v <span class="s2">"</span><span class="nv">$PWD</span><span class="s2">:/data"</span> aoirint/open_jtalk -h
The Japanese TTS System <span class="s2">"Open JTalk"</span>
Version <span class="m">1</span>.10 <span class="o">(</span>http://open-jtalk.sourceforge.net/<span class="o">)</span>
Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2008</span>-2016 Nagoya Institute of Technology
All rights reserved.

The HMM-Based Speech Synthesis Engine <span class="s2">"hts_engine API"</span>
Version <span class="m">1</span>.10 <span class="o">(</span>http://hts-engine.sourceforge.net/<span class="o">)</span>
Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2001</span>-2015 Nagoya Institute of Technology
              <span class="m">2001</span>-2008 Tokyo Institute of Technology
All rights reserved.

Yet Another Part-of-Speech and Morphological Analyzer <span class="s2">"Mecab"</span>
Version <span class="m">0</span>.996 <span class="o">(</span>http://mecab.sourceforge.net/<span class="o">)</span>
Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2001</span>-2008 Taku Kudo
              <span class="m">2004</span>-2008 Nippon Telegraph and Telephone Corporation
All rights reserved.

NAIST Japanese Dictionary
Version <span class="m">0</span>.6.1-20090630 <span class="o">(</span>http://naist-jdic.sourceforge.jp/<span class="o">)</span>
Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2009</span> Nara Institute of Science and Technology
All rights reserved.

open_jtalk - The Japanese TTS system <span class="s2">"Open JTalk"</span>

  usage:
       open_jtalk <span class="o">[</span> options <span class="o">]</span> <span class="o">[</span> infile <span class="o">]</span> 
  options:                                                                   <span class="o">[</span>  def<span class="o">][</span> min-- max<span class="o">]</span>
    -x  dir        : dictionary directory                                    <span class="o">[</span>  N/A<span class="o">]</span>
    -m  htsvoice   : HTS voice files                                         <span class="o">[</span>  N/A<span class="o">]</span>
    -ow s          : filename of output wav audio <span class="o">(</span>generated speech<span class="o">)</span>         <span class="o">[</span>  N/A<span class="o">]</span>
    -ot s          : filename of output trace information                    <span class="o">[</span>  N/A<span class="o">]</span>
    -s  i          : sampling frequency                                      <span class="o">[</span> auto<span class="o">][</span>   <span class="m">1</span>--    <span class="o">]</span>
    -p  i          : frame period <span class="o">(</span>point<span class="o">)</span>                                    <span class="o">[</span> auto<span class="o">][</span>   <span class="m">1</span>--    <span class="o">]</span>
    -a  f          : all-pass constant                                       <span class="o">[</span> auto<span class="o">][</span> <span class="m">0</span>.0-- <span class="m">1</span>.0<span class="o">]</span>
    -b  f          : postfiltering coefficient                               <span class="o">[</span>  <span class="m">0</span>.0<span class="o">][</span> <span class="m">0</span>.0-- <span class="m">1</span>.0<span class="o">]</span>
    -r  f          : speech speed rate                                       <span class="o">[</span>  <span class="m">1</span>.0<span class="o">][</span> <span class="m">0</span>.0--    <span class="o">]</span>
    -fm f          : additional half-tone                                    <span class="o">[</span>  <span class="m">0</span>.0<span class="o">][</span>    --    <span class="o">]</span>
    -u  f          : voiced/unvoiced threshold                               <span class="o">[</span>  <span class="m">0</span>.5<span class="o">][</span> <span class="m">0</span>.0-- <span class="m">1</span>.0<span class="o">]</span>
    -jm f          : weight of GV <span class="k">for</span> spectrum                               <span class="o">[</span>  <span class="m">1</span>.0<span class="o">][</span> <span class="m">0</span>.0--    <span class="o">]</span>
    -jf f          : weight of GV <span class="k">for</span> log F0                                 <span class="o">[</span>  <span class="m">1</span>.0<span class="o">][</span> <span class="m">0</span>.0--    <span class="o">]</span>
    -g  f          : volume <span class="o">(</span>dB<span class="o">)</span>                                             <span class="o">[</span>  <span class="m">0</span>.0<span class="o">][</span>    --    <span class="o">]</span>
    -z  i          : audio buffer size <span class="o">(</span><span class="k">if</span> <span class="nv">i</span><span class="o">==</span><span class="m">0</span>, turn off<span class="o">)</span>                   <span class="o">[</span>    <span class="m">0</span><span class="o">][</span>   <span class="m">0</span>--    <span class="o">]</span>
  infile:
    text file                                                                <span class="o">[</span>stdin<span class="o">]</span>
</code></pre></div>
<ul>
<li><a href="http://namotch.hatenablog.com/entry/2015/06/25/225000">Debian Jessie に OpenJtalk を入れてテキストを読み上げてみた - 残しときます（自分用）</a></li>
<li><a href="https://qiita.com/sukesuke/items/be2a4562bd809ccc0fab">合成音声(Open Jtalk)でwavファイルを作成しないで再生する - Qiita</a></li>
<li><a href="http://www.mmdagent.jp/">mmdagent.jp</a></li>
<li><a href="http://open-jtalk.sp.nitech.ac.jp/index.php">Open JTalk - HMM-based Text-to-Speech System</a></li>
</ul>
</div>

</article>


</div>

</main>

<aside class="tocbar-box">
  <nav class="tocbar fixed-scrollable">

<div class="toc-box">
  <h4><a href="./" style="color: inherit; text-decoration: none;">Table of Contents</a></h4>
  <ul class="toc">
  
    <li>
      <a href="#h_entry_2021_open_jtalk_index_md_Open_JTalk_in_Docker" class="toc-item toc-item-h1">
        Open JTalk in Docker
      </a>
  
  </ul>

</div>


  </nav>
</aside>

<footer class="footer">

  <p class="copyright-text">
    Copyright © 2020- aoirint.

  <p class="theme-text">
    Theme
    <a href="https://github.com/aoirint/aoirint-miyadaiku-theme-blog">aoirint-miyadaiku-theme-blog</a>.
  <p class="poweredby-text">
    Powered by
    <a href="https://github.com/miyadaiku/miyadaiku">Miyadaiku</a>.
</footer>


</body>
</html>