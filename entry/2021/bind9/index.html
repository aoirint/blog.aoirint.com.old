
<!DOCTYPE html>
<html lang="ja-JP">
<head>
  

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>bind9 - えやみぐさ</title>
  


<link rel="shortcut icon" href="../../../favicon.ico">




<meta property="og:url" content="https://blog.aoirint.com/entry/2021/bind9/" />
<meta property="og:locale" content="ja-JP" />
<meta property="og:type" content="article" />

<meta property="og:title" content="bind9 - えやみぐさ" />

<meta name="description" content="bind9 server$ sudo apt install bind9 使用中のDNSサーバの確認 クライアントに設定されているDNSサーバはnmcliコマンドで確認できる。 $ nmcli device show | grep DNS IP4.DNS[1]: 8.8.8.8 IP4.D"/>
<meta property="og:description" content="bind9 server$ sudo apt install bind9 使用中のDNSサーバの確認 クライアントに設定されているDNSサーバはnmcliコマンドで確認できる。 $ nmcli device show | grep DNS IP4.DNS[1]: 8.8.8.8 IP4.D" />
<meta property="og:image" content="https://blog.aoirint.com/ogp.png" />
<meta property="article:published_time" content="2021-06-09T01:30:00+09:00" />


<meta name="keywords" content="DNS,DNS,bind9">


<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@aoirint">
<meta name="twitter:creator" content="@aoirint">


<link href="https://blog.aoirint.com/atom.xml" type="application/atom+xml" rel="alternate" title="えやみぐさ Atom Feed" />
<link href="https://blog.aoirint.com/rss.rdf" type="application/rss+xml" rel="alternate" title="えやみぐさ RSS Feed" />

<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../../../static/aoirint-blog/css/style.css">

<script defer src="../../../static/fontawesome/js/all.min.js"></script>
  <script defer src="../../../static/fontawesome/js/v4-shims.min.js"></script>
<link rel="stylesheet" href="../../../static/pygments/native.css">


    
  

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-157155944-5"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-157155944-5');
  </script>
  

<script src="../../../static/aoirint-blog/js/main.js"></script>

<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>


</head>

<body>
  

<nav class="sitebar">
  <div class="sitebar-left">
    
    <a href="https://cse.google.com/cse?cx=4b57e8a4ef2a8c489" target="_blank" class="sitebar-button">
      <i class="fas fa-search"></i>
    </a>
    

    <a href="../../../atom.xml" title="RSS Feed" class="sitebar-button">
      <i class="fas fa-rss"></i>
    </a>

  <!--
    <a href="../../../atom.xml" title="Atom Feed" class="sitebar-button">
      <i class="fas fa-rss"></i>
    </a>
  -->

    
    <a href="https://twitter.com/aoirint" target="_blank" title="Twitter @aoirint" class="sitebar-button">
      <i class="fab fa-twitter"></i>
    </a>
    

    
    <a href="https://github.com/aoirint" target="_blank" title="GitHub @aoirint" class="sitebar-button">
      <i class="fab fa-github"></i>
    </a>
    
  </div>


  <div class="sitebar-center">
    <a href="../../../" class="sitebar-title">
      えやみぐさ
    </a>
    
    <div class="sitebar-description">
      Blog by aoirint
    </div>
    
  </div>

  <div class="sitebar-right">
    <button class="toggle-tocbar sitebar-button" type="button" onclick="toggleTocBarIfSmartphone();">
      <i class="fas fa-list"></i>
    </button>

  </div>

</nav>

<main class="main-content">

<div class="container">


<article class="article">


<div class="article-metadata">
  <div class="article-date">
    2021-06-09
  </div>

  <div class="article-tags">

    <a href="../../../category/DNS/" class="article-category">
      DNS
    </a>



    <a href="../../../tags/DNS/" class="article-tag">
      DNS
    </a>

    <a href="../../../tags/bind9/" class="article-tag">
      bind9
    </a>

  </div>

</div>



<div class="article-body">
  <h1 class="md_header_block" id="h_entry_2021_bind9_index_md_bind9">bind9</h1>
<div class="highlight"><pre><span></span><code>server$ sudo apt install bind9
</code></pre></div>
<h2 class="md_header_block" id="h_entry_2021_bind9_index_md_使用中のDNSサーバの確認">使用中のDNSサーバの確認</h2>
<p>クライアントに設定されているDNSサーバは<code>nmcli</code>コマンドで確認できる。</p>
<div class="highlight"><pre><span></span><code>$ nmcli device show <span class="p">|</span> grep DNS
IP4.DNS<span class="o">[</span><span class="m">1</span><span class="o">]</span>:                             <span class="m">8</span>.8.8.8
IP4.DNS<span class="o">[</span><span class="m">2</span><span class="o">]</span>:                             <span class="m">8</span>.8.4.4
IP4.DNS<span class="o">[</span><span class="m">3</span><span class="o">]</span>:                             <span class="m">1</span>.1.1.1
</code></pre></div>
<ul>
<li><a href="https://askubuntu.com/questions/152593/command-line-to-list-dns-servers-used-by-my-system">Command-line to list DNS servers used by my system - Ask Ubuntu</a></li>
</ul>
<h2 class="md_header_block" id="h_entry_2021_bind9_index_md_用語">用語</h2>
<ul>
<li><a href="http://cos.linux-dvr.biz/archives/category/bind-dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E6%A7%8B%E7%AF%89">BIND DNSサーバー構築 | CentOSサーバー構築入門</a></li>
</ul>
<h3 class="md_header_block" id="h_entry_2021_bind9_index_md_コンテンツサーバ_権威サーバ_">コンテンツサーバ（権威サーバ）</h3>
<p>あるゾーン（DNSにおける名前の管理単位）に関する名前解決要求（非再帰問い合わせ）を受け取り、自身が管理するゾーンならば名前解決結果を、委任情報を持つゾーンならば委任先の権威サーバ情報を応答する。</p>
<p>ルートゾーン（FQDN: <code>.</code>）を管理するルートサーバは、TLD（例えば <code>jp.</code>）の権威サーバへの委任情報を持つ。</p>
<p>ゾーン情報において、NSレコードにより指定される。</p>
<ul>
<li><a href="https://jprs.jp/glossary/index.php?ID=0155">JPRS用語辞典｜ルートゾーン</a></li>
<li><a href="https://jprs.jp/glossary/index.php?ID=0145">JPRS用語辞典｜権威サーバー（権威DNSサーバー）</a></li>
<li><a href="https://jprs.jp/glossary/index.php?ID=0157">JPRS用語辞典｜ネームサーバー（DNSサーバー）</a></li>
</ul>
<h3 class="md_header_block" id="h_entry_2021_bind9_index_md_キャッシュサーバ_フルサービスリゾルバ_">キャッシュサーバ（フルサービスリゾルバ）</h3>
<p>クライアントから名前解決要求（再帰問い合わせ）を受け取り、
コンテンツサーバへ反復的に名前解決要求（反復問い合わせ）を送ることで任意のドメイン名の名前解決を行う。</p>
<ul>
<li><a href="https://jprs.jp/glossary/index.php?ID=0158">JPRS用語辞典｜フルサービスリゾルバー（キャッシュDNSサーバー）</a></li>
</ul>
<p>例えば<code>hoge.example.jp.</code>というドメインの名前解決要求を受け取ったとき、
ルートサーバ<code>.</code>への非再帰問い合わせにより<code>jp.</code>権威サーバへの委任情報を取得する。
<code>jp.</code>権威サーバへの非再帰問い合わせにより<code>example.jp.</code>権威サーバへの委任情報を取得する。
<code>example.jp.</code>権威サーバへの非再帰問い合わせにより<code>hoge.example.jp.</code>のIPアドレスを取得する、のような流れで反復的に問い合わせを行うことで<code>hoge.example.jp.</code>の名前解決を行う。</p>
<h3 class="md_header_block" id="h_entry_2021_bind9_index_md_回送">回送</h3>
<p>プロキシのように、受け取った名前解決要求を他のDNSサーバに送り、
応答を返す。</p>
<h2 class="md_header_block" id="h_entry_2021_bind9_index_md__etc_bind_named_conf_options">/etc/bind/named.conf.options</h2>
<p>自身が管理していない情報（ゾーン、委任情報）に関する問い合わせについて、
他のDNSサーバ（フルサービスリゾルバ）に問い合わせを回送するように設定する。</p>
<ul>
<li><a href="https://www.atmarkit.co.jp/ait/articles/1510/28/news013.html">「再帰問い合わせ」と「非再帰問い合わせ」の違いを教えてください：DNS Tips - ＠IT</a></li>
<li><a href="http://cos.linux-dvr.biz/archives/category/bind-dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E6%A7%8B%E7%AF%89">BIND DNSサーバー構築 | CentOSサーバー構築入門</a></li>
<li><a href="http://ddns.blog.jp/archives/13568266.html">フォワード（回送） : お父さんのためのDNS講座</a></li>
</ul>
<h3 class="md_header_block" id="h_entry_2021_bind9_index_md_デフォルト設定ファイル">デフォルト設定ファイル</h3>
<div class="highlight"><pre><span></span><code>options {
        directory "/var/cache/bind";

        // If there is a firewall between you and nameservers you want
        // to talk to, you may need to fix the firewall to allow multiple
        // ports to talk.  See http://www.kb.cert.org/vuls/id/800113

        // If your ISP provided one or more IP addresses for stable
        // nameservers, you probably want to use them as forwarders.
        // Uncomment the following block, and insert the addresses replacing
        // the all-0's placeholder.

        // forwarders {
        //      0.0.0.0;
        // };

        //========================================================================
        // If BIND logs error messages about the root key being expired,
        // you will need to update your keys.  See https://www.isc.org/bind-keys
        //========================================================================
        dnssec-validation auto;

        auth-nxdomain no;    # conform to RFC1035
        listen-on-v6 { any; };
};
</code></pre></div>
<h3 class="md_header_block" id="h_entry_2021_bind9_index_md_変更点">変更点</h3>
<div class="highlight"><pre><span></span><code>forwarders {
        8.8.8.8;
        8.8.4.4;
        1.1.1.1;
};
</code></pre></div>
<ul>
<li><a href="https://www.isoroot.jp/blog/2929/">初歩から解説！BINDでシンプルDNSサーバー構築【構築編】｜ 開発者ブログ ｜ 株式会社アイソルート</a></li>
</ul>
<h3 class="md_header_block" id="h_entry_2021_bind9_index_md_確認">確認</h3>
<div class="highlight"><pre><span></span><code>server$ systemctl restart bind9.service
</code></pre></div>
<div class="highlight"><pre><span></span><code>client$ dig @192.168.x.x aoirint.com
...
<span class="p">;;</span> ANSWER SECTION:
aoirint.com.        <span class="m">3600</span>    IN  A   <span class="m">185</span>.199.108.153
aoirint.com.        <span class="m">3600</span>    IN  A   <span class="m">185</span>.199.111.153
aoirint.com.        <span class="m">3600</span>    IN  A   <span class="m">185</span>.199.109.153
aoirint.com.        <span class="m">3600</span>    IN  A   <span class="m">185</span>.199.110.153
...
</code></pre></div>
<ul>
<li><a href="https://qiita.com/hana_shin/items/e99f64a01f2632b7a719">digコマンドの使い方 - Qiita</a></li>
</ul>
<h2 class="md_header_block" id="h_entry_2021_bind9_index_md__etc_bind_named_conf_local">/etc/bind/named.conf.local</h2>
<p>DNSサーバの管理するゾーンの名前と対応する設定ファイル（ゾーンファイル）を設定する。</p>
<div class="highlight"><pre><span></span><code>//
// Do any local configuration here
//

zone "example.com" IN {
        type master;
        file "example.com.zone";
};

// Consider adding the 1918 zones here, if they are not used in your
// organization
//include "/etc/bind/zones.rfc1918";
</code></pre></div>
<h2 class="md_header_block" id="h_entry_2021_bind9_index_md__var_cache_bind_example_com_zone">/var/cache/bind/example.com.zone</h2>
<p>ゾーン情報を設定する。</p>
<div class="highlight"><pre><span></span><code>$ORIGIN example.com.
$TTL    3600
  @       IN     SOA   dns.example.com.   root.example.com. (
    2021060900      ; Serial
    3600            ; Refresh
    900             ; Retry
    604800          ; Expire
    86400           ; Minimum
)

        IN     NS    dns.example.com.
dns     IN     A     192.168.xx.xx

@       IN     A     192.168.xx.xx
local   IN     A     192.168.xx.xx
dev     IN     A     192.168.xx.xx
</code></pre></div>
<div class="highlight"><pre><span></span><code>server$ systemctl restart bind9.service
</code></pre></div>
<div class="highlight"><pre><span></span><code>client$ dig @192.168.x.x example.com
...
<span class="p">;;</span> ANSWER SECTION:
example.com.        <span class="m">3600</span>    IN  A   <span class="m">192</span>.168.xx.xx
...


client$ dig @192.168.x.x local.example.com
...
<span class="p">;;</span> ANSWER SECTION:
local.example.com.      <span class="m">3600</span>    IN  A   <span class="m">192</span>.168.xx.xx
...


client$ dig @192.168.x.x dev.example.com
...
<span class="p">;;</span> ANSWER SECTION:
dev.example.com.        <span class="m">3600</span>    IN  A   <span class="m">192</span>.168.xx.xx
...
</code></pre></div>
<ul>
<li><a href="https://www.isoroot.jp/blog/2929/">初歩から解説！BINDでシンプルDNSサーバー構築【構築編】｜ 開発者ブログ ｜ 株式会社アイソルート</a></li>
<li><a href="https://www.atmarkit.co.jp/ait/articles/0306/03/news002_2.html">サブドメインの運用と委任：実用 BIND 9で作るDNSサーバ（6）（2/3 ページ） - ＠IT</a></li>
<li><a href="https://qiita.com/m1220/items/e2093f8f5dc1a6ce9802">bind9で内部向けDNS構築　（Ubuntu14.04 Server） - Qiita</a></li>
</ul>
</div>

</article>


</div>

</main>

<aside class="tocbar-box">
  <nav class="tocbar fixed-scrollable">

<div class="toc-box">
  <h4><a href="./" style="color: inherit; text-decoration: none;">Table of Contents</a></h4>
  <ul class="toc">
  
    <li>
      <a href="#h_entry_2021_bind9_index_md_bind9" class="toc-item toc-item-h1">
        bind9
      </a>
  
    <li>
      <a href="#h_entry_2021_bind9_index_md_使用中のDNSサーバの確認" class="toc-item toc-item-h2">
        使用中のDNSサーバの確認
      </a>
  
    <li>
      <a href="#h_entry_2021_bind9_index_md_用語" class="toc-item toc-item-h2">
        用語
      </a>
  
    <li>
      <a href="#h_entry_2021_bind9_index_md_コンテンツサーバ_権威サーバ_" class="toc-item toc-item-h3">
        コンテンツサーバ（権威サーバ）
      </a>
  
    <li>
      <a href="#h_entry_2021_bind9_index_md_キャッシュサーバ_フルサービスリゾルバ_" class="toc-item toc-item-h3">
        キャッシュサーバ（フルサービスリゾルバ）
      </a>
  
    <li>
      <a href="#h_entry_2021_bind9_index_md_回送" class="toc-item toc-item-h3">
        回送
      </a>
  
    <li>
      <a href="#h_entry_2021_bind9_index_md__etc_bind_named_conf_options" class="toc-item toc-item-h2">
        /etc/bind/named.conf.options
      </a>
  
    <li>
      <a href="#h_entry_2021_bind9_index_md_デフォルト設定ファイル" class="toc-item toc-item-h3">
        デフォルト設定ファイル
      </a>
  
    <li>
      <a href="#h_entry_2021_bind9_index_md_変更点" class="toc-item toc-item-h3">
        変更点
      </a>
  
    <li>
      <a href="#h_entry_2021_bind9_index_md_確認" class="toc-item toc-item-h3">
        確認
      </a>
  
    <li>
      <a href="#h_entry_2021_bind9_index_md__etc_bind_named_conf_local" class="toc-item toc-item-h2">
        /etc/bind/named.conf.local
      </a>
  
    <li>
      <a href="#h_entry_2021_bind9_index_md__var_cache_bind_example_com_zone" class="toc-item toc-item-h2">
        /var/cache/bind/example.com.zone
      </a>
  
  </ul>

</div>


  </nav>
</aside>

<footer class="footer">

  <p class="copyright-text">
    Copyright © 2020- aoirint.

  <p class="theme-text">
    Theme
    <a href="https://github.com/aoirint/aoirint-miyadaiku-theme-blog">aoirint-miyadaiku-theme-blog</a>.
  <p class="poweredby-text">
    Powered by
    <a href="https://github.com/miyadaiku/miyadaiku">Miyadaiku</a>.
</footer>


</body>
</html>